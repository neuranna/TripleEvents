%% Script to get lateralization values from _lat files
%% 2021-09-17 Anna Ivanova (annaiv@mit.edu) based on a prev script by Yotaro Sueoka

clearvars;

subjects = {'433_FED_20160908c_3T1_PL2017',...
    '741_FED_20190320a_3T2_PL2017',...
    '777_FED_20190611c_3T2_PL2017',...
    '249_FED_20170110a_3T2_PL2017',...
    '252_FED_20181010b_3T2_PL2017',...
    '291_FED_20160523a_3T2_PL2017',...
    '301_FED_20150708c_3T2_PL2017',...
    '343_FED_20160107a_3T2_PL2017',...
    '376_FED_20160401b_3T2_PL2017',...
    '399_FED_20160519d_3T1_PL2017',...
    '400_FED_20160520a_3T1_PL2017',...
    '401_FED_20160520d_3T1_PL2017',...
    '419_FED_20160805a_3T1_PL2017',...
    '420_FED_20160805b_3T1_PL2017',...
    '426_FED_20160908d_3T1_PL2017',...
    '671_FED_20190625a_3T2_PL2017',...
    '682_FED_20190426a_3T2_PL2017',...
    '767_FED_20190418b_3T2_PL2017',...
    '768_FED_20190517a_3T2_PL2017',...
    '769_FED_20190522a_3T2_PL2017',...
    '770_FED_20190523b_3T2_PL2017',...
    '773_FED_20190605c_3T2_PL2017',...
    '774_FED_20190605b_3T2_PL2017',...
    '775_FED_20190611a_3T2_PL2017',...
    '778_FED_20190614b_3T2_PL2017'};
nsub = length(subjects); 
firstSubj = 4;
lastSubj = nsub; % can be adjusted for debugging

subjDir = '/mindhive/evlab/u/Shared/SUBJECTS/';

% outputs
%tables = cell(nsub);

for ss = firstSubj:lastSubj
    
    %Get the id of the subject
    name = split(subjects{ss},'_');
    uid = name{1};
    
    lat_name = [name{2}, '_', name{3}, '_',name{4}, '_lat.csv'];
    
    %Load the lat file
    lat_file = fullfile(subjDir, subjects{ss}, lat_name);
    t = readtable(lat_file);
    disp(t)
    
    % concatenate
    if exist('tables', 'var')
        tables = [tables; t];
    else
        tables = t;
    end
    
    writetable(tables, 'lateralization_EventsRev.csv');
end

disp(tables)
