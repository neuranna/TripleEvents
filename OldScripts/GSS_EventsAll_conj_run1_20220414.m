% note - some subjects are filtered out (accuracy, lat)

addpath(genpath('/om/group/evlab/software/spm12'))
addpath(genpath('/om/group/evlab/software/spm_ss'))
addpath /om/group/evlab/software/conn
conn_module el init

date = '20220414';

my_contrast1 = 'ODD_Sent_Sem-Perc';
my_contrast2 = 'ODD_Pic_Sem-Perc';
control_contrast1 = 'EVEN_Sent_Sem-Perc';   % used to evaluate parcel quality but here will essentially be ignored
control_contrast2 = 'EVEN_Pic_Sem-Perc';

% combine data across 3 experiments
experiments1=struct(...
    'name','EventsOrig_instrsep_2runs',...% events subjects
    'pwd1','/mindhive/evlab/u/Shared/SUBJECTS',...
    'pwd2','firstlevel_EventsOrig_instrsep_2runs',...
    'data', {{'040_KAN_langevents_01_PL2017',...
    '057_KAN_langevents_02_PL2017',...
    '059_KAN_langevents_04_PL2017',...
    '056_KAN_langevents_05_PL2017',...
    '067_KAN_langevents_06_PL2017',...
    '068_KAN_langevents_07_PL2017',...
    '019_KAN_langevents_08_PL2017',...
    '070_KAN_langevents_11_PL2017',...
    '087_KAN_langevents_12_PL2017',...
    '078_KAN_langevents_13_PL2017',...
    '089_KAN_langevents_15_PL2017',...
    '076_KAN_langevents_16_PL2017' }});

experiments2=struct(...
    'name','events2move_instrsep',...% events subjects
    'pwd1','/mindhive/evlab/u/Shared/SUBJECTS',...
    'pwd2','firstlevel_events2move_instrsep',...
    'data', {{'199_FED_20160711c_3T1_PL2017',...
    '261_FED_20160523c_3T2_PL2017',...
    '291_FED_20160803c_3T1_PL2017',...
    '400_FED_20160520a_3T1_PL2017',...
    '407_FED_20160804a_3T1_PL2017',...
    '419_FED_20160805a_3T1_PL2017',...
    '408_FED_20160711a2_3T1_PL2017',...
    '409_FED_20160622a_3T1_PL2017',...
    '410_FED_20160623b_3T2_PL2017',...
    '730_FED_20190306a_3T2_PL2017',...
    '776_FED_20190611b_3T2_PL2017',...
    '773_FED_20190605c_3T2_PL2017',...
    '774_FED_20190605b_3T2_PL2017',...
    '775_FED_20190611a_3T2_PL2017',...
    '778_FED_20190614b_3T2_PL2017'}});

experiments3=struct(...
    'name','EventsRev_instrsep',...% events subjects
    'pwd1','/mindhive/evlab/u/Shared/SUBJECTS',...
    'pwd2','firstlevel_EventsRev_instrsep',...
    'data', {{'249_FED_20160519a_3T1_PL2017', ...
        '252_FED_20160907b_3T2_PL2017', ...
        '291_FED_20160803c_3T1_PL2017', ...  
        '301_FED_20160908b_3T1_PL2017', ...
        '376_FED_20160519b_3T1_PL2017', ...
        '399_FED_20160519d_3T1_PL2017', ...
        '400_FED_20160520a_3T1_PL2017', ...
        '401_FED_20160520d_3T1_PL2017', ...
        '419_FED_20160805a_3T1_PL2017', ... 
        '420_FED_20160805b_3T1_PL2017', ... 
        '426_FED_20160908d_3T1_PL2017', ...  
        '767_FED_20190418b_3T2_PL2017',...
        '768_FED_20190517a_3T2_PL2017',...
        '769_FED_20190522a_3T2_PL2017',...
        '770_FED_20190523b_3T2_PL2017',...
        '682_FED_20190426a_3T2_PL2017',...
        '773_FED_20190605c_3T2_PL2017',...
        '774_FED_20190605b_3T2_PL2017',...
        '775_FED_20190611a_3T2_PL2017',...
        '778_FED_20190614b_3T2_PL2017'}});

spmfiles={};
counter=1;

for nsub=1:length(experiments1.data),
    spmfiles{counter}=fullfile(experiments1.pwd1,experiments1.data{nsub},experiments1.pwd2,'SPM.mat');
    counter = counter + 1;
end
for nsub=1:length(experiments2.data),
    spmfiles{counter}=fullfile(experiments2.pwd1,experiments2.data{nsub},experiments2.pwd2,'SPM.mat');
    counter = counter + 1;
end
for nsub=1:length(experiments3.data),
    spmfiles{counter}=fullfile(experiments3.pwd1,experiments3.data{nsub},experiments3.pwd2,'SPM.mat');
    counter = counter + 1;
end


ss=struct(...
    'swd',['/home/annaiv/annaiv/TripleEvents/GSS_EventsAll/' my_contrast1 '_' my_contrast2 '_' date],...   % output directory
    'files_spm',{spmfiles},...                              % first-level SPM.mat files
    'EffectOfInterest_contrasts',{{control_contrast1, control_contrast2}},...    % contrasts of interest
    'Localizer_contrasts',{{my_contrast1, my_contrast2}},...         % localizer contrast (note: if these contrasts are not orthogonal the toolbox will automatically partition theses contrasts by sessions and perform cross-validation) 
    'Localizer_thr_type',{{'none', 'none'}},...
    'Localizer_thr_p',[.05, .05],... 
    'overlap_thr_vox',.05,...	 
    'overlap_thr_roi',.5,...   
    'type','GcSS',...                                       % can be 'GcSS' (for automatically defined ROIs), 'mROI' (for manually defined ROIs), or 'voxel' (for voxel-based analyses)
    'smooth',6,...                                          % (FWHM mm)
    'model',1,...                                           % can be 1 (one-sample t-test), 2 (two-sample t-test), or 3 (multiple regression)
    'ExplicitMasking', [], ...
    'estimation','OLS',...
    'ask','none');                                       % can be 'none' (any missing information is assumed to take default values), 'missing' (any missing information will be asked to the user), 'all' (it will ask for confirmation on each parameter)
ss=spm_ss_design(ss);                                          % see help spm_ss_design for additional information
ss=spm_ss_estimate(ss);



